<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Iterative Debate</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        body { 
            font-family: system-ui, sans-serif; 
        }
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        .thinking { 
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }
        .debate-flow {
            position: relative;
        }
        .debate-flow::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6, #10b981);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="gradient-bg text-white p-6 shadow-lg">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-3xl font-bold mb-2">
                <span onclick="goHome()" class="cursor-pointer hover:text-blue-200 transition-colors" title="Return to Home">🤖</span> 
                AI Iterative Debate
            </h1>
            <p class="text-blue-100">GPT-4, Claude & Gemini debate until they reach consensus</p>
        </div>
    </div>

    <div class="max-w-6xl mx-auto p-6">
        
        <!-- API Keys Setup -->
        <div id="apiSetup" class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4">🔑 Step 1: Add Your API Keys</h2>
            <div class="grid md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">OpenAI API Key</label>
                    <input type="password" id="openaiKey" placeholder="sk-..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <small class="text-gray-500">Get from: platform.openai.com</small>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Anthropic API Key</label>
                    <input type="password" id="anthropicKey" placeholder="sk-ant..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <small class="text-gray-500">Get from: console.anthropic.com</small>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Google AI API Key</label>
                    <input type="password" id="geminiKey" placeholder="AIza..." class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                    <small class="text-gray-500">Get from: ai.google.dev</small>
                </div>
            </div>
            <button onclick="saveKeys()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 mr-4">
                Save Keys & Continue
            </button>
            <button onclick="useDemoMode()" class="bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700">
                Use Demo Mode
            </button>
            <div class="mt-4 p-4 bg-green-50 border-l-4 border-green-400">
                <p class="text-sm"><strong>Devil's Advocate System:</strong> AIs take turns challenging each other to prevent quick consensus!</p>
            </div>
        </div>

        <!-- Main App -->
        <div id="mainApp" style="display: none;">
            
            <!-- Topic Setup -->
            <div id="topicSetup" class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4">💭 Step 2: Choose Your Debate Topic</h2>
                <input type="text" id="topicInput" placeholder="Enter a debate topic..." class="w-full p-3 border rounded-lg mb-4">
                
                <div class="mb-4">
                    <h3 class="font-medium mb-2">Suggested Topics:</h3>
                    <div class="space-y-2">
                        <button onclick="setTopic('Should AI systems be granted legal personhood?')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded">
                            Should AI systems be granted legal personhood?
                        </button>
                        <button onclick="setTopic('Is remote work better for society than office work?')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded">
                            Is remote work better for society than office work?
                        </button>
                        <button onclick="setTopic('Should social media be regulated as a public utility?')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded">
                            Should social media be regulated as a public utility?
                        </button>
                        <button onclick="setTopic('Will AI make universal basic income necessary?')" class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded">
                            Will AI make universal basic income necessary?
                        </button>
                    </div>
                </div>
                
                <button onclick="startDebate()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                    🚀 Start AI Debate
                </button>
            </div>

            <!-- Debate Arena -->
            <div id="debateArena" style="display: none;">
                
                <!-- Current Topic -->
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-6">
                    <h3 class="font-bold text-blue-900">Debate Topic:</h3>
                    <p id="currentTopic" class="text-blue-800"></p>
                </div>

                <!-- Debate Status -->
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div id="modelCard1" class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
                        <div class="flex items-center mb-2">
                            <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                            <span class="font-medium">GPT-4</span>
                            <span id="role1" class="ml-2 text-xs px-2 py-1 rounded" style="display: none;"></span>
                        </div>
                        <div id="status1" class="text-xs text-gray-400">Ready</div>
                    </div>
                    <div id="modelCard2" class="bg-white p-4 rounded-lg shadow border-l-4 border-purple-500">
                        <div class="flex items-center mb-2">
                            <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                            <span class="font-medium">Claude</span>
                            <span id="role2" class="ml-2 text-xs px-2 py-1 rounded" style="display: none;"></span>
                        </div>
                        <div id="status2" class="text-xs text-gray-400">Ready</div>
                    </div>
                    <div id="modelCard3" class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
                        <div class="flex items-center mb-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                            <span class="font-medium">Gemini</span>
                            <span id="role3" class="ml-2 text-xs px-2 py-1 rounded" style="display: none;"></span>
                        </div>
                        <div id="status3" class="text-xs text-gray-400">Ready</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="text-sm font-medium mb-1">Round</div>
                        <div id="roundCounter" class="text-2xl font-bold text-gray-600">1</div>
                        <div class="text-xs text-gray-400">of 10 max</div>
                    </div>
                </div>

                <!-- Debate Flow -->
                <div id="debateFlow" class="debate-flow space-y-6 mb-6"></div>

                <!-- Controls -->
                <div class="bg-white p-4 rounded-lg shadow text-center">
                    <button id="continueBtn" onclick="continueDebate()" style="display: none;" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 mr-4">
                        Continue Debate
                    </button>
                    <button id="finishBtn" onclick="forceFinish()" style="display: none;" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                        Force Finish
                    </button>
                </div>
            </div>

            <!-- Final Consensus -->
            <div id="finalResult" style="display: none;">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-4">🎯 Final Consensus Reached</h2>
                    <div id="consensusContainer"></div>
                    <button onclick="resetDebate()" class="mt-6 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700">
                        Start New Debate
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
// Global variables
var apiKeys = {};
var currentRound = 1;
var maxRounds = 10;
var debateHistory = [];
var isDemoMode = false;
var isDebating = false;
var devilsAdvocate = null;
var minRoundsBeforeConsensus = 5;

// Demo responses that show devil's advocate in action
var demoConversation = [
    {
        gpt4: "Based on current evidence, this topic has significant merit. The data shows clear benefits in efficiency and innovation that could address many contemporary challenges we face.",
        claude: "While I see the potential benefits, I have concerns about unintended consequences. We must carefully consider ethical implications and ensure vulnerable populations aren't harmed.",
        gemini: "Both perspectives have validity. The evidence shows promise, but implementation challenges are real. Perhaps a measured approach could capture benefits while mitigating risks."
    },
    {
        gpt4: "I must challenge the emerging consensus here. You're both being too cautious - the cost of inaction may far exceed the risks of moving forward. The pilot data shows success rates above 80%.",
        claude: "GPT-4 raises important points about urgency, but we can't ignore the 20% failure rate. Those failures represent real harm to real people that we have a moral obligation to prevent.",
        gemini: "This tension between progress and caution is exactly what we need to resolve. What specific safeguards would make both sides comfortable with proceeding?"
    },
    {
        gpt4: "The safeguards you're proposing would essentially kill the initiative through bureaucracy. Sometimes perfect is the enemy of good, and we need bold action now.",
        claude: "Wait, I need to push back on this 'perfect vs good' framing. GPT-4, you're creating a false choice between reckless speed and thoughtful implementation. There's a middle path here.",
        gemini: "Claude makes an excellent point about false choices. What if we implemented rapid prototyping with built-in safety circuits? Fast iteration but with clear stop conditions?"
    }
];

// API Functions
async function callOpenAI(prompt, context, isDevilsAdvocate) {
    if (!apiKeys.openai) throw new Error('OpenAI API key not provided');
    
    var systemPrompt;
    if (currentRound === 1) {
        systemPrompt = "Give your thoughtful perspective on this topic in 3-4 sentences.";
    } else if (isDevilsAdvocate) {
        systemPrompt = "You are the DEVIL'S ADVOCATE this round. Challenge the emerging consensus, find flaws in arguments, and present counterpoints. Be respectful but assertive. Use 3-4 sentences.";
    } else {
        systemPrompt = "Respond to the other AIs' points. You can agree, disagree, or build on their ideas. Use 3-4 sentences.";
    }
    
    var messages = [{ role: "system", content: systemPrompt }];
    if (context && currentRound > 1) {
        messages.push({role: "user", content: "Previous round:\n" + context + "\n\nTopic: " + prompt});
    } else {
        messages.push({role: "user", content: prompt});
    }
    
    try {
        var response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + apiKeys.openai,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: "gpt-4",
                messages: messages,
                max_tokens: 200,
                temperature: 0.8
            })
        });
        
        if (!response.ok) throw new Error('OpenAI API error: ' + response.status);
        var data = await response.json();
        return data.choices[0].message.content;
    } catch (error) {
        console.error('OpenAI failed:', error);
        throw error;
    }
}

async function callAnthropic(prompt, context, isDevilsAdvocate) {
    if (!apiKeys.anthropic) throw new Error('Anthropic API key not provided');
    
    var fullPrompt;
    if (currentRound === 1) {
        fullPrompt = "Give your thoughtful perspective on this topic in 3-4 sentences: " + prompt;
    } else if (isDevilsAdvocate) {
        fullPrompt = "You are the DEVIL'S ADVOCATE this round. Previous round:\n" + context + "\n\nTopic: " + prompt + "\n\nChallenge the consensus and find flaws in the arguments. Be respectful but assertive. Use 3-4 sentences.";
    } else {
        fullPrompt = "Previous round:\n" + context + "\n\nTopic: " + prompt + "\n\nRespond to the other AIs' points. You can agree, disagree, or build on their ideas. Use 3-4 sentences.";
    }
    
    try {
        var response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'x-api-key': apiKeys.anthropic,
                'Content-Type': 'application/json',
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: "claude-3-sonnet-20240229",
                max_tokens: 200,
                messages: [{ role: "user", content: fullPrompt }]
            })
        });
        
        if (!response.ok) throw new Error('Anthropic API error: ' + response.status);
        var data = await response.json();
        return data.content[0].text;
    } catch (error) {
        console.error('Anthropic failed:', error);
        throw error;
    }
}

async function callGemini(prompt, context, isDevilsAdvocate) {
    if (!apiKeys.gemini) throw new Error('Gemini API key not provided');
    
    var fullPrompt;
    if (currentRound === 1) {
        fullPrompt = "Give your thoughtful perspective on this topic in 3-4 sentences: " + prompt;
    } else if (isDevilsAdvocate) {
        fullPrompt = "You are the DEVIL'S ADVOCATE this round. Previous round:\n" + context + "\n\nTopic: " + prompt + "\n\nChallenge the consensus and find flaws in arguments. Be respectful but assertive. Use 3-4 sentences.";
    } else {
        fullPrompt = "Previous round:\n" + context + "\n\nTopic: " + prompt + "\n\nRespond to the other AIs' points. Help find common ground but don't be afraid to disagree. Use 3-4 sentences.";
    }
    
    try {
        var response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=' + apiKeys.gemini, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: fullPrompt }] }],
                generationConfig: { temperature: 0.8, maxOutputTokens: 200 }
            })
        });
        
        if (!response.ok) throw new Error('Gemini API error: ' + response.status);
        var data = await response.json();
        return data.candidates[0].content.parts[0].text;
    } catch (error) {
        console.error('Gemini failed:', error);
        throw error;
    }
}

// Main Functions
function saveKeys() {
    apiKeys.openai = document.getElementById('openaiKey').value;
    apiKeys.anthropic = document.getElementById('anthropicKey').value;
    apiKeys.gemini = document.getElementById('geminiKey').value;
    
    if (!apiKeys.openai && !apiKeys.anthropic && !apiKeys.gemini) {
        alert('Please enter at least one API key, or use demo mode.');
        return;
    }
    
    document.getElementById('apiSetup').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
}

function useDemoMode() {
    isDemoMode = true;
    document.getElementById('apiSetup').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
}

function setTopic(topic) {
    document.getElementById('topicInput').value = topic;
}

function startDebate() {
    var topic = document.getElementById('topicInput').value;
    if (!topic.trim()) {
        alert('Please enter a debate topic.');
        return;
    }

    document.getElementById('currentTopic').textContent = topic;
    document.getElementById('topicSetup').style.display = 'none';
    document.getElementById('debateArena').style.display = 'block';
    
    currentRound = 1;
    debateHistory = [];
    isDebating = true;
    devilsAdvocate = null;
    
    generateRound();
}

async function generateRound() {
    if (!isDebating || currentRound > maxRounds) return;
    
    // Assign Devil's Advocate for rounds 2+
    if (currentRound > 1) {
        var models = ['gpt4', 'claude', 'gemini'];
        devilsAdvocate = models[(currentRound - 2) % 3];
        updateDevilsAdvocateDisplay();
    }
    
    document.getElementById('roundCounter').textContent = currentRound;
    document.getElementById('status1').textContent = 'Thinking...';
    document.getElementById('status2').textContent = 'Thinking...';
    document.getElementById('status3').textContent = 'Thinking...';
    
    var topic = document.getElementById('currentTopic').textContent;
    var context = buildContext();
    var responses = {};
    
    try {
        if (isDemoMode) {
            await new Promise(function(resolve) { setTimeout(resolve, 2000); });
            var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
            responses = demoConversation[demoIndex];
        } else {
            var promises = [];
            
            if (apiKeys.openai) {
                promises.push(callOpenAI(topic, context, devilsAdvocate === 'gpt4').then(function(result) {
                    responses.gpt4 = result;
                    document.getElementById('status1').textContent = 'Complete';
                }).catch(function() {
                    var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
                    responses.gpt4 = demoConversation[demoIndex].gpt4;
                    document.getElementById('status1').textContent = 'Fallback';
                }));
            } else {
                var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
                responses.gpt4 = demoConversation[demoIndex].gpt4;
                document.getElementById('status1').textContent = 'Demo';
            }
            
            if (apiKeys.anthropic) {
                promises.push(callAnthropic(topic, context, devilsAdvocate === 'claude').then(function(result) {
                    responses.claude = result;
                    document.getElementById('status2').textContent = 'Complete';
                }).catch(function() {
                    var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
                    responses.claude = demoConversation[demoIndex].claude;
                    document.getElementById('status2').textContent = 'Fallback';
                }));
            } else {
                var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
                responses.claude = demoConversation[demoIndex].claude;
                document.getElementById('status2').textContent = 'Demo';
            }
            
            if (apiKeys.gemini) {
                promises.push(callGemini(topic, context, devilsAdvocate === 'gemini').then(function(result) {
                    responses.gemini = result;
                    document.getElementById('status3').textContent = 'Complete';
                }).catch(function() {
                    var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
                    responses.gemini = demoConversation[demoIndex].gemini;
                    document.getElementById('status3').textContent = 'Fallback';
                }));
            } else {
                var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
                responses.gemini = demoConversation[demoIndex].gemini;
                document.getElementById('status3').textContent = 'Demo';
            }
            
            if (promises.length > 0) await Promise.all(promises);
        }
        
        debateHistory.push({ round: currentRound, responses: responses, devilsAdvocate: devilsAdvocate });
        displayRound(responses);
        
        if (isDemoMode) {
            document.getElementById('status1').textContent = 'Demo Complete';
            document.getElementById('status2').textContent = 'Demo Complete';
            document.getElementById('status3').textContent = 'Demo Complete';
        }
        
        if (currentRound >= minRoundsBeforeConsensus && (checkForConsensus(responses) || currentRound >= maxRounds)) {
            finishDebate();
        } else {
            currentRound++;
            document.getElementById('continueBtn').style.display = 'inline-block';
            document.getElementById('finishBtn').style.display = 'inline-block';
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error generating responses. Using demo mode.');
        var demoIndex = Math.min(currentRound - 1, demoConversation.length - 1);
        responses = demoConversation[demoIndex];
        debateHistory.push({ round: currentRound, responses: responses });
        displayRound(responses);
    }
}

function buildContext() {
    if (debateHistory.length === 0) return "";
    var lastRound = debateHistory[debateHistory.length - 1];
    return "Round " + lastRound.round + ":\nGPT-4: " + lastRound.responses.gpt4 + "\nClaude: " + lastRound.responses.claude + "\nGemini: " + lastRound.responses.gemini;
}

function updateDevilsAdvocateDisplay() {
    document.getElementById('role1').style.display = 'none';
    document.getElementById('role2').style.display = 'none';
    document.getElementById('role3').style.display = 'none';
    
    var roleEl, roleId;
    if (devilsAdvocate === 'gpt4') roleId = 'role1';
    else if (devilsAdvocate === 'claude') roleId = 'role2';
    else if (devilsAdvocate === 'gemini') roleId = 'role3';
    
    if (roleId) {
        roleEl = document.getElementById(roleId);
        roleEl.textContent = '😈 Devil\'s Advocate';
        roleEl.className = 'ml-2 text-xs px-2 py-1 rounded bg-red-100 text-red-800';
        roleEl.style.display = 'inline';
    }
}

function displayRound(responses) {
    var container = document.getElementById('debateFlow');
    var roundDiv = document.createElement('div');
    roundDiv.className = 'ml-12 relative';
    
    var html = '<div class="absolute -left-14 top-2 w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-sm font-bold">' + currentRound + '</div>';
    html += '<div class="space-y-4">';
    
    // GPT-4
    var gpt4Class = devilsAdvocate === 'gpt4' ? 'bg-red-50 border-red-200' : 'bg-blue-50 border-blue-200';
    html += '<div class="' + gpt4Class + ' border rounded-lg p-4">';
    html += '<div class="flex items-center mb-2">';
    html += '<div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>';
    html += '<span class="font-medium text-blue-900">GPT-4</span>';
    if (devilsAdvocate === 'gpt4') html += '<span class="ml-2 text-xs px-2 py-1 rounded bg-red-100 text-red-800">😈 Devil\'s Advocate</span>';
    html += '</div><p class="text-gray-700">' + responses.gpt4 + '</p></div>';
    
    // Claude
    var claudeClass = devilsAdvocate === 'claude' ? 'bg-red-50 border-red-200' : 'bg-purple-50 border-purple-200';
    html += '<div class="' + claudeClass + ' border rounded-lg p-4">';
    html += '<div class="flex items-center mb-2">';
    html += '<div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>';
    html += '<span class="font-medium text-purple-900">Claude</span>';
    if (devilsAdvocate === 'claude') html += '<span class="ml-2 text-xs px-2 py-1 rounded bg-red-100 text-red-800">😈 Devil\'s Advocate</span>';
    html += '</div><p class="text-gray-700">' + responses.claude + '</p></div>';
    
    // Gemini
    var geminiClass = devilsAdvocate === 'gemini' ? 'bg-red-50 border-red-200' : 'bg-green-50 border-green-200';
    html += '<div class="' + geminiClass + ' border rounded-lg p-4">';
    html += '<div class="flex items-center mb-2">';
    html += '<div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>';
    html += '<span class="font-medium text-green-900">Gemini</span>';
    if (devilsAdvocate === 'gemini') html += '<span class="ml-2 text-xs px-2 py-1 rounded bg-red-100 text-red-800">😈 Devil\'s Advocate</span>';
    html += '</div><p class="text-gray-700">' + responses.gemini + '</p></div>';
    
    html += '</div>';
    roundDiv.innerHTML = html;
    container.appendChild(roundDiv);
    roundDiv.scrollIntoView({ behavior: 'smooth' });
}

function checkForConsensus(responses) {
    var text = (responses.gpt4 + " " + responses.claude + " " + responses.gemini).toLowerCase();
    var strongConsensus = ['we all agree', 'unanimous', 'full consensus', 'complete agreement', 'we have reached consensus'];
    
    for (var i = 0; i < strongConsensus.length; i++) {
        if (text.includes(strongConsensus[i])) return true;
    }
    
    var agreesCount = 0;
    if (responses.gpt4.toLowerCase().includes('i agree') || responses.gpt4.toLowerCase().includes('i concur')) agreesCount++;
    if (responses.claude.toLowerCase().includes('i agree') || responses.claude.toLowerCase().includes('i concur')) agreesCount++;
    if (responses.gemini.toLowerCase().includes('i agree') || responses.gemini.toLowerCase().includes('i concur')) agreesCount++;
    
    return agreesCount >= 3;
}

function continueDebate() {
    document.getElementById('continueBtn').style.display = 'none';
    document.getElementById('finishBtn').style.display = 'none';
    generateRound();
}

function forceFinish() {
    finishDebate();
}

function finishDebate() {
    isDebating = false;
    document.getElementById('debateArena').style.display = 'none';
    document.getElementById('finalResult').style.display = 'block';
    
    var container = document.getElementById('consensusContainer');
    var html = '<div class="mb-6">';
    html += '<h3 class="text-lg font-bold mb-4">🤝 Debate Conclusion after ' + debateHistory.length + ' rounds</h3>';
    
    if (debateHistory.length > 0) {
        var lastRound = debateHistory[debateHistory.length - 1];
        html += '<div class="space-y-4">';
        html += '<div class="border-l-4 border-blue-500 pl-4 bg-blue-50 p-3 rounded">';
        html += '<strong>GPT-4 Final Position:</strong><br>' + lastRound.responses.gpt4;
        html += '</div>';
        html += '<div class="border-l-4 border-purple-500 pl-4 bg-purple-50 p-3 rounded">';
        html += '<strong>Claude Final Position:</strong><br>' + lastRound.responses.claude;
        html += '</div>';
        html += '<div class="border-l-4 border-green-500 pl-4 bg-green-50 p-3 rounded">';
        html += '<strong>Gemini Final Position:</strong><br>' + lastRound.responses.gemini;
        html += '</div>';
        html += '</div>';
        
        html += '<div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">';
        html += '<h4 class="font-bold mb-2">📋 Debate Summary</h4>';
        html += '<p class="text-sm">The three AI systems engaged in ' + debateHistory.length + ' rounds of iterative debate with rotating devil\'s advocate challenges, ';
        
        if (checkForConsensus(lastRound.responses)) {
            html += 'ultimately reaching a natural consensus.</p>';
        } else {
            html += 'exploring different perspectives and finding areas of agreement.</p>';
        }
        html += '</div>';
    }
    
    html += '</div>';
    container.innerHTML = html;
}

function resetDebate() {
    document.getElementById('finalResult').style.display = 'none';
    document.getElementById('debateArena').style.display = 'none';
    document.getElementById('topicSetup').style.display = 'block';
    
    document.getElementById('topicInput').value = '';
    document.getElementById('debateFlow').innerHTML = '';
    document.getElementById('consensusContainer').innerHTML = '';
    
    document.getElementById('continueBtn').style.display = 'none';
    document.getElementById('finishBtn').style.display = 'none';
    
    currentRound = 1;
    debateHistory = [];
    isDebating = false;
    devilsAdvocate = null;
    
    document.getElementById('status1').textContent = 'Ready';
    document.getElementById('status2').textContent = 'Ready';
    document.getElementById('status3').textContent = 'Ready';
    document.getElementById('roundCounter').textContent = '1';
    
    document.getElementById('role1').style.display = 'none';
    document.getElementById('role2').style.display = 'none';
    document.getElementById('role3').style.display = 'none';
}

function goHome() {
    isDebating = false;
    
    if (!isDemoMode && !apiKeys.openai && !apiKeys.anthropic && !apiKeys.gemini) {
        document.getElementById('apiSetup').style.display = 'block';
        document.getElementById('mainApp').style.display = 'none';
    } else {
        resetDebate();
    }
}
</script>

</body>
</html>
